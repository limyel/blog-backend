<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.limyel.blog.mapper.PostMapper">
  <resultMap id="BaseResultMap" type="com.limyel.blog.entity.Post">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="created_at" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt" />
    <result column="deleted" jdbcType="BIT" property="deleted" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="content" jdbcType="VARCHAR" property="content" />
    <result column="slug" jdbcType="VARCHAR" property="slug" />
    <result column="introduction" jdbcType="VARCHAR" property="introduction" />
  </resultMap>

  <resultMap id="PostInHome" type="com.limyel.blog.entity.dto.PostInHome">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="created_at" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="slug" jdbcType="VARCHAR" property="slug" />
    <result column="introduction" jdbcType="VARCHAR" property="introduction" />
    <collection property="tags" ofType="com.limyel.blog.entity.dto.TagInPost">
      <id column="t_id" property="id"/>
      <result column="t_name" property="name"/>
    </collection>
  </resultMap>

  <select id="selectPostInHome" resultMap="PostInHome">
    select t1.id, t1.created_at, t1.updated_at, t1.title, t1.slug, t1.introduction, t3.id t_id, t3.name t_name from post t1
        left join post_tag t2 on t2.post_id = t1.id
        left join tag t3 on t3.id = t2.tag_id and t3.deleted = 0
    where t1.deleted = 0 order by t1.created_at desc
    -- group by 分组用来防止分页错误
  </select>
</mapper>